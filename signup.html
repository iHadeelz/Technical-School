<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ | TechFlow Academy</title>
    <style>
        :root { --primary: #1a2a6c; --bg: #f4f7f9; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .signup-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        h2 { color: var(--primary); margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.3s; }
        button:hover { background: #2a3a7c; }
        .login-link { margin-top: 15px; font-size: 14px; }
        .login-link a { color: var(--primary); text-decoration: none; font-weight: bold; }
        #msg { margin-top: 10px; font-size: 14px; display: none; }
    </style>
</head>
<body>

    <div class="signup-card">
        <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø·Ø§Ù„Ø¨ ğŸ“</h2>
        <input type="text" id="firstName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„" required>
        <input type="email" id="studentEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
        <input type="password" id="studentPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
        <button id="btnSignup">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¢Ù†</button>
        
        <div id="msg"></div>

        <div class="login-link">
            Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ <a href="login.html">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù‡Ù†Ø§</a>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCB76yITZG4XNa6AXNPkIR8PxLZuMv1j3Y",
            authDomain: "techflowacademy-3e89c.firebaseapp.com",
            projectId: "techflowacademy-3e89c",
            appId: "1:373744584399:web:a57f9fb4f6129cd5e059ba"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        document.getElementById('btnSignup').addEventListener('click', async () => {
            const name = document.getElementById('firstName').value;
            const email = document.getElementById('studentEmail').value;
            const pass = document.getElementById('studentPass').value;
            const msgDiv = document.getElementById('msg');

            if(!name || !email || !pass) {
                alert("Ù‡Ø¯ÙˆÙ„ØªÙŠØŒ Ø¹Ø¨ÙŠ ÙƒÙ„ Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø£ÙˆÙ„ ğŸŒ¸");
                return;
            }

            try {
                // 1. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙÙŠ Firebase Auth
                const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
                const user = userCredential.user;

                // 2. ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ ÙÙŠ Firestore (Ø¨Ù…Ø§ ÙÙŠÙ‡Ø§ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ÙƒÙ…Ø§ Ø·Ù„Ø¨ØªÙ)
                await setDoc(doc(db, "students", user.uid), {
                    first_name: name,
                    email: email,
                    pass: pass, // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹ ÙÙŠ Ø§Ù„Ù„ÙˆØ¬Ù†
                    role: "student",
                    is_online: false,
                    current_device_id: "",
                    created_at: serverTimestamp()
                });

                msgDiv.style.display = "block";
                msgDiv.style.color = "green";
                msgDiv.innerText = "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„Ùƒ...";
                
                // Ø§Ù„ØªÙˆØ¬Ù‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
                setTimeout(() => { window.location.href = "student_page.html"; }, 2000);

            } catch (error) {
                msgDiv.style.display = "block";
                msgDiv.style.color = "red";
                msgDiv.innerText = "Ø®Ø·Ø£: " + error.message;
            }
        });
    </script>
</body>
</html>